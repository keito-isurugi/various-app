# 要件定義（追加機能）：MAXアップ「プログラム算出」機能（MVP+）

> 既存MVP（1RM → 当日メニュー即時計算）に対し、MAXアップ向けに **複数週の固定プログラム** を算出・表示する機能を追加する。  
> 本追加機能も **フロントエンドのみで完結**し、サーバー・ログイン・DBは使用しない。  
> ※「進捗に応じた自動調整（停滞判定・自動増量・自動デロード）」は本要件では扱わない（将来拡張）。

---

## 1. 目的
ユーザーが入力した big3 の 1RM（最大挙上重量）から、MAXアップ day について **N週間分のプログラム（週次の強度・回数・セット・重量）** を自動算出し、即時表示する。

---

## 2. 対象範囲

### In Scope
- **入力**
  - 既存：SQ / BP / DL の 1RM（kg）
  - 既存：重量刻み（1.25 / 2.5 / 5 kg）
  - 追加：MAXアップ プログラム設定（オプション）
    - プログラム期間（select）
      - 4週 / 6週 / 8週
      - デフォルト：4週
    - 週間頻度（select）
      - 週1回 / 週2回
      - デフォルト：週1回
    - 表示方式（任意）
      - 「今週だけ表示」/「全週表示」
      - 初期実装は「全週表示」固定でも可

- **出力（各種目ごと）**
  - 既存：MAXアップ day（単発メニュー）
  - 追加：MAXアップ プログラム（Week1〜WeekN）
    - 週ごとの %1RM
    - 週ごとの 回数 × セット
    - 週ごとの 計算済み重量（kg、丸め済み）
    - 週2回の場合は A/B（Heavy/Light）として2枠表示

### Out of Scope（本追加要件でも対象外）
- 実施ログの保存
- 進捗に応じた自動調整（増量・停滞・デロード判定）
- 当日RPE入力による自動再計算（オートレギュレーション）
- 補助種目の自動選定
- ユーザー情報の保存・同期（※ localStorage は将来拡張で許容）

---

## 3. 画面要件（既存1画面に追加）

### 3.1 入力UI（追加）
- 「MAXアップ プログラム」設定エリア（折りたたみ可）
  - プログラム期間（4/6/8週）
  - 週間頻度（週1/週2）
  - 重量刻み（既存）と連動

### 3.2 出力UI（追加）
- 種目カード（SQ/BP/DL）の **MAXアップ day セクション内**に「プログラム」表示を追加
- 表示形式（テーブル推奨）
  - カラム例：
    - 週（Week）
    - 強度（%1RM）
    - 設定（回数×セット）
    - 重量（kg）
    - （週2回の場合）枠（A=Heavy / B=Light）

---

## 4. 計算仕様（固定テンプレ）

> MVP+では **固定プログラムテンプレート** を採用し、ユーザーの進捗入力なしで算出できることを優先する。

### 4.1 MAXアップ プログラムテンプレート（デフォルト：4週）
- Week1：85% / 3回 × 5セット
- Week2：87.5% / 3回 × 5セット
- Week3：90% / 3回 × 4セット（強度UPに伴いボリュームを微減）
- Week4：80% / 3回 × 3セット（調整週）

計算式：
weight = roundToIncrement(1RM × percent, increment)

※ percent は上記テンプレの各週の値を採用する

### 4.2 週間頻度（週2回）の扱い（A/B固定ルール）
- A（Heavy）：各週テンプレをそのまま適用
- B（Light）：A の強度から **-5%（固定）**
  - reps/sets は A と同一（初期実装）
  - 例：Week2
    - A：87.5% / 3×5
    - B：82.5% / 3×5

計算式：
weightB = roundToIncrement(1RM × (percentA - 0.05), increment)

※ 0.05 は固定値（将来拡張で変更可能にしてもよい）

### 4.3 6週・8週テンプレート（拡張テンプレ）
- 6週・8週を選択した場合は、以下のいずれかの方式で実装する
  - 方式A（推奨）：6週/8週専用の固定配列テンプレを用意する
  - 方式B（簡易）：4週テンプレを反復し、最終週を調整週にする

※ MVP+では方式Bを許容（実装容易性優先）

---

## 5. 丸め仕様（既存踏襲）
- `roundToIncrement(x, inc)` は最も近い刻みに四捨五入
- 例（inc = 2.5kg）
  - 63 → 62.5
  - 64 → 65
- 計算結果が 0 以下の場合は表示せず、入力エラーとして扱う

---

## 6. 入力バリデーション（既存＋追加）
- 1RM
  - 数値であること
  - 1kg以上
  - 上限（任意）：500kg
- 追加オプション
  - 週数：4/6/8 のいずれか
  - 頻度：週1/週2 のいずれか
- 未入力の種目はカードを非表示、または「未入力」と表示（既存踏襲）

---

## 7. 受入基準（Acceptance Criteria）
- 1RMを入力すると、各種目の MAXアップ プログラム（Week1〜WeekN）が即時表示される
- 週数（4/6/8）を変更すると、表示が即時に切り替わる
- 週間頻度（週1/週2）を変更すると、A/B（Heavy/Light）が即時に反映される
- 重量刻み（1.25/2.5/5）を変更すると、プログラム全週の重量が即時に再計算される
- 不正入力（空欄・負数・文字列）の場合はエラーメッセージを表示し、計算は行われない

---

## 8. 将来拡張（任意）
- テンプレのカスタマイズ（開始強度、週ごとの増分、B日の強度差）
- 当日RPE入力による自動調整（トップセット@8、バックオフ自動算出）
- 停滞判定・デロード挿入の自動化
- localStorage による入力値・設定値の保持
- 1RM推定（重量×回数 → 推定1RM → プログラム算出）
