# 肩たたき券 Web対応 要件定義

## 現状（紙ベース）
- PDFを生成してダウンロード
- 印刷して紙で使用
- QRコードを管理者がスキャンして利用開始

## Web対応の目的
- 紙の印刷が不要な場合でも使える
- URLを共有するだけで利用できる
- スマホで簡単に見られる
- 紙とWebの両方の使い方をサポート

## 機能要件

### 1. 肩たたき券表示ページ
**目的**: Web上で肩たたき券を見られるページ

**機能**:
- チケットIDをURLパラメータで受け取る（`/massage-ticket/[ticketId]`）
- 肩たたき券の情報を表示
  - 利用者名
  - チケットID
  - 有効期限
  - 残り回数/時間
  - 利用単位（回数/時間）
- QRコードを大きく表示（管理者がスキャンしやすい）
- スマホで見やすいデザイン
- ダークモード対応

**URL例**: 
- `/massage-ticket/view/1700000000000-abc123`
- `/massage-ticket/1700000000000-abc123`（短縮形も検討）

### 2. 作成時の選択肢拡張
**目的**: 紙とWebの両方をサポート

**機能**:
- 作成後に以下を選択できるようにする
  1. PDFをダウンロード（紙用）
  2. Webで表示（URLを表示・コピー）
  3. 両方

**表示内容**:
- 作成成功メッセージ
- 「PDFをダウンロード」ボタン
- 「Webで表示」ボタン（新しいページを開く）
- 共有用URL表示（コピーボタン付き）
- QRコード表示（管理者が直接スキャンできる）

### 3. URL共有機能
**目的**: 利用者が管理者に簡単に共有できる

**機能**:
- URLをクリップボードにコピー
- 共有ボタン（LINE、メール、SNSなど）
- QRコードを画面表示（管理者がスマホでスキャン）

### 4. 管理者側の改善
**目的**: Web経由でもスムーズに利用開始できる

**機能**:
- 肩たたき券表示ページから直接「利用開始」できる
  - 管理者用のモード切り替え
  - または、表示ページ内に「管理者向け」セクションを追加
- QRコード読み込みページでもURLから直接アクセスできる（既存機能の拡張）

## 技術的な考慮事項

### セキュリティ
- **現状**: チケットIDを知っていれば誰でもアクセス可能
- **考慮点**: 
  - 認証は不要（簡単に使えることが優先）
  - ただし、チケットIDは推測困難な長い文字列
  - 改ざん防止は既存のハッシュ検証で対応

### パフォーマンス
- 肩たたき券の情報はFirestoreから取得
- キャッシュは不要（リアルタイム性が重要）

### レスポンシブデザイン
- スマホで見やすいレイアウト
- QRコードは画面サイズに応じて調整

## UI/UX要件

### 肩たたき券表示ページ
- シンプルで分かりやすいデザイン
- 重要な情報（利用者名、残り回数/時間）を強調
- QRコードを目立つ位置に配置
- 印刷しても使えるデザイン（オプション）

### 作成完了画面
- 成功メッセージ
- PDFダウンロードボタン
- Web表示へのリンク
- URLコピーボタン
- QRコードプレビュー

## 実装の優先順位

### Phase 1（基本機能）
1. 肩たたき券表示ページの作成
2. 作成時にURLを表示
3. URLから肩たたき券を表示

### Phase 2（利便性向上）
1. URLコピーボタン
2. QRコードの画面表示（作成時）
3. 作成完了画面の改善

### Phase 3（高度な機能）
1. 共有機能（LINE、メールなど）
2. 管理者が表示ページから直接利用開始
3. 利用履歴の表示

## 課題・検討事項

1. **URLの形式**
   - 短縮URLにするか？（例: `/ticket/abc123`）
   - 現状の長いIDのままでいいか？

2. **アクセス制御**
   - 認証なしでOKか？
   - 将来的に認証が必要になった場合の拡張性

3. **エラーハンドリング**
   - 存在しないチケットIDにアクセスした場合
   - 有効期限切れの場合
   - 既に使用済みの場合

4. **両方の使い方のサポート**
   - 紙とWeb、どちらでも使えるようにする
   - 作成時に両方のオプションを提供

